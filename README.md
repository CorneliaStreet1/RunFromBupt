# 动态污点分析工具的实现

利用动态污点分析技术，获取程序运行时信息，能够帮助开发人员定位软件缺陷。基于开源污点分析工具DECAF++、PANDA或二进制分析框架Angr，本毕设开发细粒度的动态污点分析工具，监控程序执行并跟踪程序输入的传播来挖掘程序中的数据结构和程序输入字段，以及跟踪通过指针传播的程序输入。

### 什么是动态污点分析?

摘自《漏洞利用及渗透测试基础（第2版）》

什么是污点传播分析？

- 污点传播分析技术是通过分析代码中输入数据对程序执行路径的影响吗，以发现不可信的输入数据导致的程序执行异常。
- 污点数据：需要进行标记分析的输入数据。
- 污点传播首先对污点数据进行标记，并静态跟踪程序代码中污点数据的传播路径，发现使用污点数据的不安全执行路径，进而分析出由于非法数据的使用而引发的输入异常类漏洞。



动态污点分析应该是属于漏洞挖掘技术中的动态检测类别。

- 动态检测：针对运行中的软件程序，通过构造非正常的输入来检测软件运行时是否出现故障或者崩溃等非正常的输出，并通过检测软件运行中的内部状态信息来验证或者检测软件缺陷。



动态污点分析技术：通过分析被测试程序内部指令真实的执行过程，追踪输入数据在程序内部的传递、处理流程，以检测输入数据是否存在涉及安全的敏感操作，从而分析出污点数据导致的潜在安全缺陷和漏洞。

- 基本思想：在程序的执行过程中跟踪用户输入数据在寄存器和内存单元之间的传播过程，然后监测被测试程序对输入数据使用的相关信息。 

具体到操作：

给所有的不可信污点数据标记一个唯一的标签，然后跟踪这些标签在可执行程序中的传递过程。跟踪这些标签在二进制程序中传播时，不仅考虑二进制程序中的数据依赖关系，而且考虑二进制程序中不同变量之间的控制依赖关系。动态污点分析技术可以识别出**输入文件**中的<u>哪些字节会影响二进制程序中涉及安全敏感操作的函数</u>，如内存分配函数、字符串函数和其他的一些函数,从而发现可能触发安全缺陷和漏洞的污点数据



例如,建立在 Pin 基础之上的动态污点分析技术具体实现过程是这样的。Pin 是由Intel公司开发和维护,具有跨平台特性的一个强大的动态二进制指令分析框架。动态污点分析首先利用 Pin 的插能力来挂钩操作系统的一些系统函数,当软件运行读入输人数据时，**通过挂钩的系统函数获得输入数据在内存的位置和被读入内存中的具体输入数据，将它们作为被测试程序的污点源**。然后,从被测试程序人口地址开始**以基本块为单位**读取并监测执行的指令,当监测到被测程序作为污点源的输入数据时,开始执行动态污点跟踪。<u>每次被测程序加载新的指令块时,都会监测作为污点源的输入数据是否被事先挂钩的危险函数调用。如果有调用,则发现输入函数导致的危险操作,输出记录以待后续测试。如果没有监测到调用,则继续加载新的指令块并执行相应监测操作。</u>

- 基本块的概念：我不确定这是否是从《编译原理》引入的一个概念，但是我应该只在编译原理中接触过这个概念。在编译原理的范畴内，基本块是指：（见第九章目标代码生成的Slide）
  - 基本块具有原子性的一组连续语句序列。控制从第一条语句（入口语句）流入，从最后一条语句（出口语句）流出，中途没有停止或分支。

- 基本块的划分：
  1. 确定入口语句：
     - 三地址代码的第一条语句
     - goto语句转移到的目标语句
     - 紧跟在goto语句后面的语句。
  2. 确定基本块：与每一个入口语句相应的基本块。
     - 从一个入口语句（含该语句）到下一个入口语句（不含）之间的语句序列
     - 从一个入口语句（含该语句）到停止语句（含该语句）之间的语句序列。

## (State of) The Art of War: Offensive Techniques in Binary Analysis

### I. INTRODUCTION

就讲了一件事：angr为什么需要存在，它存在的意义是什么，以及angr框架所作出的贡献有哪些，作者在angr这个二进制分析框架中所做的事情。

> 简而言之，我们做出了以下贡献：
> 1) 我们在一个单一、连贯的框架中重现了进攻性二进制分析中的许多现有方法，以提供对当前进攻性二进制分析技术相对有效性的理解。
> 2) 我们展示了将多种二进制分析技术结合起来并大规模应用的困难（以及这些困难的解决方案）。
> 3) 我们开源了我们的框架 angr，供后代二进制代码分析研究使用。

### II. AUTOMATED BINARY ANALYSIS

也基本上是没啥用的信息，对于我实现动态污点分析工具来说。

比较重要的内容就是讲了实现自动分析中存在的Trade Offs：

1. 
